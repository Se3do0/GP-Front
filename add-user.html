<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>إضافة مستخدم - جامعة الغردقة</title>

    <!-- Guard -->
    <script>
        if (!localStorage.getItem("adminToken")) {
            window.location.href = "admin-login.html";
        }
    </script>

    <!-- Bootstrap RTL -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
        rel="stylesheet"
    />

    <style>
        body {
            background-color: #f6f7f9;
        }

        .navbar {
            box-shadow: 0 2px 8px rgba(0,0,0,.05);
        }

        .form-card {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 4px 16px rgba(0,0,0,.06);
            padding: 30px;
            animation: fadeUp .4s ease;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(12px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-expand-lg navbar-light bg-white px-4">
    <div class="container-fluid d-flex justify-content-between align-items-center">

        <div class="fw-bold fs-5 text-primary">
            جامعة الغردقة
        </div>

        <div class="d-flex gap-2">
            <a href="admin.html" class="btn btn-outline-primary btn-sm">
                لوحة الإدارة
            </a>
            <button class="btn btn-outline-danger btn-sm" onclick="logout()">
                تسجيل الخروج
            </button>
        </div>

    </div>
</nav>

<!-- ================= CONTENT ================= -->
<div class="container mt-5" style="max-width:650px">

    <div class="form-card">

        <h4 class="fw-bold mb-4 text-center">
            إضافة مستخدم جديد
        </h4>

        <div class="mb-3">
            <label class="form-label">الاسم الكامل</label>
            <input id="fullNameInput" class="form-control">
        </div>

        <div class="mb-3">
            <label class="form-label">البريد الإلكتروني</label>
            <input id="emailInput" type="email" class="form-control">
        </div>

        <div class="mb-3">
            <label class="form-label">كلمة المرور</label>
            <input id="passwordInput" type="password" class="form-control">
        </div>

        <!-- <div class="mb-3">
            <label class="form-label">رقم المستوى</label>
            <input id="roleInput" type="number" class="form-control">
        </div> -->

        <div class="mb-4">
            <label class="form-label">رقم الإدارة</label>
            <input id="departmentInput" type="number" class="form-control">
        </div>

        <div class="d-flex gap-2 justify-content-end">
            <a href="admin.html" class="btn btn-secondary">
                إلغاء
            </a>
            <button class="btn btn-primary" onclick="addUser()">
                حفظ المستخدم
            </button>
        </div>

    </div>
</div>

<!-- ================= SCRIPTS ================= -->
<script src="/Js/admin/data.js"></script>

<script>
async function addUser() {
    const payload = {
        email: emailInput.value.trim(),
        password: passwordInput.value.trim(),
        roleId: Number(roleInput.value),
        departmentId: Number(departmentInput.value)
    };

    if (fullNameInput.value.trim()) {
        payload.fullName = fullNameInput.value.trim();
    }

    try {
        const res = await fetch(`${BASE_URL}/api/Admin/AddUser`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${localStorage.getItem("adminToken")}`
            },
            body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (data.status !== "success") {
            throw new Error();
        }

        alert("تم إضافة المستخدم بنجاح");
        window.location.href = "admin.html";

    } catch (err) {
        alert("فشل إضافة المستخدم");
        console.error(err);
    }
}

function logout() {
    const ok = confirm("هل أنت متأكد أنك تريد تسجيل الخروج؟");
    if (!ok) return;

    localStorage.removeItem("adminToken");
    window.location.href = "login.html";
}
</script>

</body>
</html>
