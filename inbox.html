<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>نظام المعاملات</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="./Css/base.css" />
    <link rel="stylesheet" href="./Css/navbar.css" />
    <link rel="stylesheet" href="./Css/layout.css" />
    <link rel="stylesheet" href="./Css/sidebar.css" />
    <link rel="stylesheet" href="./Css/exports.css" />

    <script>
    if (!localStorage.getItem("token")) {
        window.location.href = "./login.html";
    }
    </script>


</head>

<body>

    <!-- NAVBAR -->
    <div id="navbar"></div>

    <!-- SEARCH -->
    <div class="container-fluid d-lg-none mt-3 px-4">
        <div class="position-relative search-wrapper w-100">
            <i class="bi bi-search"></i>
            <input type="text" id="searchInputSm" class="form-control" placeholder="بحث">
            <i id="clearSearchSm" class="bi bi-x-lg"></i>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="container-fluid layout-wrapper">
        <div class="row g-3 flex-row">

            <!-- SIDEBAR -->
            <div class="col-lg-3">
                <div class="card card-sidebar p-4">

                    <div class="sidebar-header">المعاملات</div>

                    <nav class="nav flex-column nav-transactions mb-4">
                        <a class="nav-link active" href="#" data-type="sent"><span>الصادرة</span><i class="bi bi-inbox-fill"></i></a>
                        <a class="nav-link" href="#" data-type="received"><span>الواردة</span><i class="bi bi-send-fill"></i></a>
                        <a class="nav-link" href="#" data-type="draft"><span>المعدة للإرسال</span><i class="bi bi-file-earmark-text"></i></a>
                        <a class="nav-link" href="#" data-type="deleted"><span>المحذوفة</span><i class="bi bi-trash3"></i></a>
                    </nav>

                    <a class="btn btn-primary w-100 btn-new" href="./add-transaction.html">معاملة جديدة</a>
                </div>
            </div>

            <!-- MAIN PANEL -->
            <div class="col-lg-9">
                <div class="card card-main p-4 d-flex flex-column">

                    <div class="exports-header d-flex justify-content-between align-items-center">
                        <span id="listTitle">الصادرات</span>
                        
                        <div id="mainSearchWrapper" class="mt-3 mb-3 mx-5">
                            <div class="position-relative search-wrapper w-100">
                                <i class="bi bi-search"></i>
                                <input type="text" id="searchInput" class="form-control" placeholder="بحث">
                                <i id="clearSearch" class="bi bi-x-lg"></i>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-outline-dark d-none" id="backToList">
                            <i class="bi bi-arrow-right-short"></i>
                            رجوع للقائمة
                        </button>
                    </div>

                    <!-- LIST VIEW -->
                    <div class="list-exports mt-3" id="exportList"></div>

                    <!-- DETAILS VIEW -->
                    <div class="mt-3 d-none" id="messageDetailsFull">

                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0 fw-bold">تفاصيل المعاملة</h5>
                            <span class="badge bg-primary" id="msgStatus">صادرة</span>
                        </div>

                        <div class="mb-4">
                            <div class="d-flex justify-content-between flex-wrap mb-2">
                                <div><span class="fw-semibold">رقم المعاملة: </span><span id="msgNumber"></span></div>
                                <div><span class="fw-semibold">تاريخ المعاملة: </span><span id="msgDate"></span></div>
                            </div>

                            <div class="d-flex justify-content-between flex-wrap">
                                <div><span class="fw-semibold">المرسل: </span><span id="msgSender"></span></div>
                            </div>
                        </div>

                        <hr>

                        <div class="mb-3">
                            <h6 class="fw-bold mb-1">موضوع المعاملة</h6>
                            <p class="mb-0 text-muted" id="msgTitle"></p>
                        </div>

                        <div class="mb-4">
                            <h6 class="fw-bold mb-2">نص الرسالة</h6>
                            <div class="p-3 rounded-3 bg-light">
                                <p class="mb-0" id="msgBody"></p>
                            </div>
                        </div>

                        <hr>

                        <div class="d-flex flex-wrap gap-2 justify-content-between">
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-dark" id="btnBack">
                                    <i class="bi bi-arrow-right-short"></i> رجوع
                                </button>
                                <button class="btn btn-outline-primary">
                                    <i class="bi bi-reply"></i> رد على المعاملة
                                </button>
                            </div>

                        </div>

                    </div>

                </div>
            </div>

        </div>
    </div>

    <script>
    // load shared navbar component
    (async function(){
        try{
            const res = await fetch('./components/navbar.html');
            if(res.ok){
                const html = await res.text();
                document.getElementById('navbar').innerHTML = html;
            }
        }catch(e){console.warn('Navbar load failed', e)}
    })();
    </script>

    <script src="./Js/data.js"></script>
    <script src="./Js/dom.js"></script>
    <script src="./Js/ui.js"></script>
    <script src="./Js/details.js"></script>
    <script src="./Js/main.js"></script>
    <script src="./Js/inbox.js"></script>


</body>
</html>
